<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Venturemond Client Dashboard</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>

<body>
    <aside class="sidebar">
        <div class="brand">
            <i class="ph-fill ph-polygon"></i> Venturemond
        </div>
        <nav class="flex-col gap-sm" style="flex: 1; overflow-y: auto;">
            <a class="nav-link active" onclick="switchTab('overview', this)"><i class="ph ph-squares-four"></i>
                Overview</a>
            <a class="nav-link" onclick="switchTab('cart', this)"><i class="ph ph-shopping-cart"></i> Cart <span
                    class="badge badge-primary" style="margin-left: auto; font-size: 0.7rem;"
                    id="nav-cart-count">0</span></a>
            <a class="nav-link" onclick="switchTab('orders', this)"><i class="ph ph-scroll"></i> Orders</a>
            <a class="nav-link" onclick="switchTab('files', this)"><i class="ph ph-folder"></i> Files</a>
            <a class="nav-link" onclick="switchTab('team', this)"><i class="ph ph-users"></i> Team</a>
            <a class="nav-link" onclick="switchTab('billing', this)"><i class="ph ph-credit-card"></i> Billing</a>
            <a class="nav-link" onclick="switchTab('analytics', this)"><i class="ph ph-chart-line-up"></i> Analytics</a>
            <a class="nav-link" onclick="switchTab('support', this)"><i class="ph ph-life-buoy"></i> Support</a>
            <a class="nav-link" onclick="switchTab('integrations', this)"><i class="ph ph-plugs"></i> Integrations</a>
            <a class="nav-link" onclick="switchTab('settings', this)"><i class="ph ph-gear"></i> Account Settings</a>
        </nav>

        <div class="user-profile cursor-pointer" onclick="toggleProfileMenu()" style="position: relative;">
            <div class="flex items-center gap-md">
                <div class="avatar"><img src="https://ui-avatars.com/api/?name=Client+User&background=8b5cf6&color=fff"
                        alt="Client"></div>
                <div class="flex-col">
                    <span style="font-weight: 600; font-size: 0.9rem;">Client User</span>
                    <span style="font-size: 0.75rem; color: var(--text-muted);">client@venturemond.com</span>
                </div>
            </div>
            <!-- Profile Dropdown -->
            <div id="profile-menu" class="hidden slide-in"
                style="position: absolute; bottom: 100%; left: 0; width: 100%; background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-bottom: 10px; z-index: 50; box-shadow: 0 4px 6px rgba(0,0,0,0.3);">
                <div class="p-3 hover-bg" onclick="switchTab('settings')"
                    style="border-bottom: 1px solid var(--border);">Settings</div>
                <div class="p-3 hover-bg" onclick="logout()" style="color: var(--danger);">Logout</div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <!-- Header -->
        <header class="flex justify-between items-center mb-4">
            <h2 id="page-title">Overview</h2>
            <div class="flex items-center gap-lg" style="position: relative;">
                <button class="btn btn-outline" style="border: none;" onclick="toggleNotifications()"><i
                        class="ph ph-bell" style="font-size: 1.2rem;"></i></button>
                <div id="notification-dropdown" class="card hidden slide-in"
                    style="position: absolute; top: 100%; right: 0; width: 300px; z-index: 1000; background: var(--bg-card); border: 1px solid var(--border);">
                    <h4 class="mb-2">Notifications</h4>
                    <div class="flex flex-col gap-sm">
                        <div class="p-2" style="border-bottom: 1px solid var(--border);">
                            <div style="font-size: 0.9rem;">Project "Alpha" Milestone 1 Approved</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">2 hours ago</div>
                        </div>
                        <div class="p-2" style="border-bottom: 1px solid var(--border);">
                            <div style="font-size: 0.9rem;">New Invoice Available</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">5 hours ago</div>
                        </div>
                        <div class="p-2">
                            <div style="font-size: 0.9rem;">Welcome to Venturemond!</div>
                            <div style="font-size: 0.7rem; color: var(--text-muted);">1 day ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Overview Tab -->
        <div id="tab-overview" class="app-section slide-in">
            <div class="stats-grid">
                <div class="card stat-card" onclick="switchTab('orders')" title="View Orders">
                    <span class="stat-label">Active Orders</span>
                    <div class="stat-value">2</div>
                </div>
                <div class="card stat-card" onclick="switchTab('billing')" title="View Invoices">
                    <span class="stat-label">Pending Invoices</span>
                    <div class="stat-value">$2,400</div>
                </div>
                <div class="card stat-card" onclick="switchTab('support')" title="View Tickets">
                    <span class="stat-label">Support Tickets</span>
                    <div class="stat-value">0</div>
                </div>
            </div>

            <div class="grid" style="grid-template-columns: 2fr 1fr; gap: var(--space-lg);">
                <div class="card">
                    <h3 class="mb-4">Recent Activity</h3>
                    <div class="flex flex-col gap-md">
                        <div class="flex items-center gap-md cursor-pointer-hover" onclick="switchTab('orders')"
                            style="padding: 10px; background: var(--bg-hover); border-radius: 8px; cursor: pointer; transition: background 0.2s;"
                            onmouseover="this.style.background='var(--bg-card)'"
                            onmouseout="this.style.background='var(--bg-hover)'">
                            <i class="ph-fill ph-check-circle" style="color: var(--success);"></i>
                            <div>
                                <div style="font-weight: 500;">Project "Alpha" Milestone 1 Approved</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">2 hours ago</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-md cursor-pointer-hover" onclick="switchTab('billing')"
                            style="padding: 10px; background: var(--bg-hover); border-radius: 8px; cursor: pointer; transition: background 0.2s;"
                            onmouseover="this.style.background='var(--bg-card)'"
                            onmouseout="this.style.background='var(--bg-hover)'">
                            <i class="ph-fill ph-file-pdf" style="color: var(--warning);"></i>
                            <div>
                                <div style="font-weight: 500;">Invoice #INV-2024-001 Generated</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Yesterday</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card"
                    style="background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none;">
                    <h3>Quick Actions</h3>
                    <div class="flex flex-col gap-sm mt-4">
                        <button class="btn" style="background: rgba(255,255,255,0.2); text-align: left;"
                            onclick="switchTab('support')">Open New Ticket</button>
                        <button class="btn" style="background: rgba(255,255,255,0.2); text-align: left;"
                            onclick="switchTab('cart')">Browse Services</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart Tab -->
        <div id="tab-cart" class="app-section hidden">
            <div class="card slide-in">
                <div class="flex justify-between items-center mb-4">
                    <h3>Your Cart</h3>
                    <button class="btn btn-outline" onclick="clearCart()">Clear Cart</button>
                </div>
                <div id="cart-items-container" class="flex flex-col gap-md"
                    style="min-height: 150px; justify-content: center; align-items: center; color: var(--text-muted);">
                    <i class="ph ph-shopping-cart" style="font-size: 3rem; margin-bottom: 10px;"></i>
                    Your cart is currently empty.
                </div>
                <div id="cart-footer" class="hidden"
                    style="margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                    <div class="flex justify-between items-center">
                        <span style="font-size: 1.2rem;">Total:</span>
                        <span style="font-size: 1.5rem; font-weight: 700;" id="cart-total">$0.00</span>
                    </div>
                    <button class="btn btn-primary w-full mt-4" onclick="handleCheckout()">Proceed to Checkout</button>
                </div>
            </div>

            <h3 class="mt-4 mb-2">Available Services (Add to Cart)</h3>
            <div class="grid"
                style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md);">
                <div class="card">
                    <h4>Web Development</h4>
                    <p>$2,500</p>
                    <button class="btn btn-outline w-full mt-2"
                        onclick="addToCart('Web Development', 2500)">Add</button>
                </div>
                <div class="card">
                    <h4>UI/UX Design</h4>
                    <p>$1,500</p>
                    <button class="btn btn-outline w-full mt-2" onclick="addToCart('UI/UX Design', 1500)">Add</button>
                </div>
                <div class="card">
                    <h4>SEO Audit</h4>
                    <p>$500</p>
                    <button class="btn btn-outline w-full mt-2" onclick="addToCart('SEO Audit', 500)">Add</button>
                </div>
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="tab-orders" class="app-section hidden">
            <div class="card slide-in">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Service</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr onclick="viewOrder(this)" style="cursor: pointer; transition: background 0.2s;"
                                onmouseover="this.style.background='var(--bg-hover)'"
                                onmouseout="this.style.background=''">
                                <td>#ORD-8821</td>
                                <td>Web Development</td>
                                <td>Oct 20, 2024</td>
                                <td><span class="badge badge-success">Active</span></td>
                                <td>$2,500</td>
                            </tr>
                            <tr onclick="viewOrder(this)" style="cursor: pointer; transition: background 0.2s;"
                                onmouseover="this.style.background='var(--bg-hover)'"
                                onmouseout="this.style.background=''">
                                <td>#ORD-7742</td>
                                <td>Logo Design</td>
                                <td>Sep 15, 2024</td>
                                <td><span class="badge badge-success">Completed</span></td>
                                <td>$800</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Files Tab -->
        <div id="tab-files" class="app-section hidden">
            <div class="grid slide-in"
                style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--space-md);">
                <div class="card flex flex-col items-center gap-sm cursor-pointer" style="text-align: center;"
                    onclick="alert('Downloading Project_Brief.pdf...')">
                    <i class="ph-fill ph-file-pdf" style="font-size: 3rem; color: var(--danger);"></i>
                    <span style="font-weight: 500;">Project_Brief.pdf</span>
                    <span style="font-size: 0.8rem; color: var(--text-muted);">2.4 MB</span>
                </div>
                <div class="card flex flex-col items-center gap-sm cursor-pointer" style="text-align: center;"
                    onclick="alert('Downloading Logo_Assets.zip...')">
                    <i class="ph-fill ph-image" style="font-size: 3rem; color: var(--primary);"></i>
                    <span style="font-weight: 500;">Logo_Assets.zip</span>
                    <span style="font-size: 0.8rem; color: var(--text-muted);">15 MB</span>
                </div>
                <div class="card flex flex-col items-center justify-center cursor-pointer"
                    style="border: 2px dashed var(--border); background: transparent;"
                    onclick="document.getElementById('file-upload').click()">
                    <i class="ph ph-upload-simple" style="font-size: 2rem; color: var(--text-muted);"></i>
                    <span style="font-size: 0.9rem; margin-top: 5px;">Upload File</span>
                    <input type="file" id="file-upload" style="display: none;"
                        onchange="alert('File selected: ' + this.files[0].name)">
                </div>
            </div>
        </div>

        <!-- Team Tab -->
        <div id="tab-team" class="app-section hidden">
            <div class="card slide-in">
                <div class="flex justify-between items-center mb-4">
                    <h3>Team Members</h3>
                    <button class="btn btn-primary" onclick="inviteMember()">Invite Member</button>
                </div>
                <div class="flex flex-col gap-md" id="team-list">
                    <div class="flex items-center justify-between p-2"
                        style="border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        <div class="flex items-center gap-md">
                            <div class="avatar">CL</div>
                            <div>
                                <div style="font-weight: 600;">Client User (You)</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Owner</div>
                            </div>
                        </div>
                        <span class="badge badge-success">Active</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Billing Tab -->
        <div id="tab-billing" class="app-section hidden">
            <div class="card slide-in">
                <h3>Invoices</h3>
                <div class="table-container mt-4">
                    <table>
                        <thead>
                            <tr>
                                <th>Invoice ID</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>#INV-2024-001</td>
                                <td>Oct 21, 2024</td>
                                <td>$2,500</td>
                                <td><span class="badge badge-warning">Unpaid</span></td>
                                <td><button class="btn btn-primary" style="padding: 4px 8px;"
                                        onclick="payInvoice(this)">Pay Now</button></td>
                            </tr>
                            <tr>
                                <td>#INV-2024-000</td>
                                <td>Sep 15, 2024</td>
                                <td>$800</td>
                                <td><span class="badge badge-success">Paid</span></td>
                                <td><button class="btn btn-outline" style="padding: 4px 8px;">Download</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="tab-analytics" class="app-section hidden">
            <div class="card slide-in">
                <h3>Project Performance</h3>
                <div class="chart-container" style="height: 250px; margin-top: 20px; position: relative;">
                    <!-- Y-Axis Lines (Background) -->
                    <div
                        style="position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: space-between; color: var(--text-muted); font-size: 0.8rem; pointer-events: none;">
                        <div style="border-bottom: 1px dashed var(--border); height: 1px; width: 100%;"></div>
                        <div style="border-bottom: 1px dashed var(--border); height: 1px; width: 100%;"></div>
                        <div style="border-bottom: 1px dashed var(--border); height: 1px; width: 100%;"></div>
                        <div style="border-bottom: 1px dashed var(--border); height: 1px; width: 100%;"></div>
                    </div>

                    <!-- Bars -->
                    <div class="flex items-end justify-between relative"
                        style="height: 100%; z-index: 1; padding: 0 10px;">
                        <!-- Bar 1 -->
                        <div class="flex flex-col items-center gap-xs"
                            style="width: 15%; height: 100%; justify-content: flex-end;">
                            <div class="bar"
                                style="width: 100%; height: 40%; background: var(--primary); border-radius: 4px 4px 0 0; transition: height 0.5s;">
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">Week 1</span>
                        </div>
                        <!-- Bar 2 -->
                        <div class="flex flex-col items-center gap-xs"
                            style="width: 15%; height: 100%; justify-content: flex-end;">
                            <div class="bar"
                                style="width: 100%; height: 65%; background: var(--primary); border-radius: 4px 4px 0 0; transition: height 0.5s;">
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">Week 2</span>
                        </div>
                        <!-- Bar 3 -->
                        <div class="flex flex-col items-center gap-xs"
                            style="width: 15%; height: 100%; justify-content: flex-end;">
                            <div class="bar"
                                style="width: 100%; height: 85%; background: var(--primary); border-radius: 4px 4px 0 0; transition: height 0.5s;">
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">Week 3</span>
                        </div>
                        <!-- Bar 4 (Projection) -->
                        <div class="flex flex-col items-center gap-xs"
                            style="width: 15%; height: 100%; justify-content: flex-end;">
                            <div class="bar"
                                style="width: 100%; height: 55%; background: var(--accent); border-radius: 4px 4px 0 0; transition: height 0.5s;">
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;">Week 4</span>
                        </div>
                    </div>
                </div>
                <!-- Legend -->
                <div class="mt-4 flex gap-lg justify-center">
                    <div class="flex items-center gap-sm">
                        <div style="width: 12px; height: 12px; background: var(--primary); border-radius: 2px;"></div>
                        <span style="font-size: 0.9rem;">Actual</span>
                    </div>
                    <div class="flex items-center gap-sm">
                        <div style="width: 12px; height: 12px; background: var(--accent); border-radius: 2px;"></div>
                        <span style="font-size: 0.9rem;">Projected</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Support Tab -->
        <div id="tab-support" class="app-section hidden">
            <div class="card slide-in">
                <div class="flex justify-between items-center mb-4">
                    <h3>Support Tickets</h3>
                    <button class="btn btn-primary" onclick="createTicket()">New Ticket</button>
                </div>
                <div id="support-empty-state" class="text-center p-4" style="color: var(--text-muted);">
                    <i class="ph ph-check-circle" style="font-size: 3rem; margin-bottom: 10px; display: block;"></i>
                    No open tickets. You're all good!
                </div>
                <div id="ticket-list" class="flex flex-col gap-md hidden"></div>
            </div>
        </div>

        <!-- Integrations Tab -->
        <div id="tab-integrations" class="app-section hidden">
            <div class="grid slide-in"
                style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md);">
                <div class="card">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-md">
                            <i class="ph-fill ph-slack-logo" style="font-size: 2rem; color: #E01E5A;"></i>
                            <div>
                                <h4 style="margin:0;">Slack</h4><span style="font-size:0.8rem;">Communication</span>
                            </div>
                        </div>
                        <label class="switch"><input type="checkbox" checked><span class="slider"></span></label>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">Receive project updates
                        directly in your Slack channel.</p>
                </div>
                <div class="card">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-md">
                            <i class="ph-fill ph-github-logo" style="font-size: 2rem;"></i>
                            <div>
                                <h4 style="margin:0;">GitHub</h4><span style="font-size:0.8rem;">Development</span>
                            </div>
                        </div>
                        <label class="switch"><input type="checkbox"><span class="slider"></span></label>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">Link repositories to sync
                        commits with tasks.</p>
                </div>
            </div>
        </div>

        <!-- Account Settings Tab -->
        <div id="tab-settings" class="app-section hidden">
            <div class="card slide-in" style="max-width: 600px;">
                <h3>My Profile</h3>
                <form class="mt-4" onsubmit="event.preventDefault(); alert('Settings Saved');">
                    <div class="form-group"><label>Full Name</label><input type="text" class="form-control"
                            value="Client User"></div>
                    <div class="form-group"><label>Email</label><input type="email" class="form-control"
                            value="client@venturemond.com" readonly style="opacity: 0.7;"></div>
                    <div class="form-group"><label>Company</label><input type="text" class="form-control"
                            value="StartUp Inc"></div>
                    <button class="btn btn-primary">Save Changes</button>
                </form>
                <div class="mt-4 pt-4 border-t border-gray-700">
                    <button class="btn btn-outline text-danger" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Order Details Modal -->
    <div id="order-modal"
        style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; align-items: center; justify-content: center;">
        <div class="card slide-in" style="width: 90%; max-width: 500px; background: var(--bg-card);">
            <div class="flex justify-between items-center mb-4">
                <h3>Order Details</h3>
                <button class="btn btn-outline" onclick="closeOrderModal()">Close</button>
            </div>
            <div id="order-modal-content"></div>
        </div>
    </div>

    <script>
        // Use style.css variables for toggle switch if needed or add simple inline
        // CSS for Toggle
        const style = document.createElement('style');
        style.innerHTML = `
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--bg-app); transition: .4s; border-radius: 20px; border: 1px solid var(--border); }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(20px); }
        .badge-primary { background: var(--primary); color: white; border-radius: 50%; width: 18px; height: 18px; display: inline-flex; justify-content: center; align-items: center; }
        `;
        document.head.appendChild(style);

        // Session Check
        const token = localStorage.getItem('access_token');
        if (!token) {
            console.warn("No token found, redirecting to login");
            window.location.href = '/';
        }

        // Fetch Dashboard Data
        async function loadDashboard() {
            if (!token) return; // Double check

            try {
                const response = await fetch('/api/client/dashboard', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Update UI with real data
                    // Note: In a real app we would have more IDs to target specific elements
                    // For now, let's just log it or update a specific one if possible
                    console.log('Dashboard Data:', data);

                    // Example: Update a hypothetical project name element if it existed or console
                    // Ideally we update the HTML to have specific IDs for these
                } else {
                    console.warn('Failed to fetch dashboard data');
                    if (response.status === 401) {
                        window.location.href = '/';
                    }
                }
            } catch (e) {
                console.error(e);
            }
        }

        loadDashboard();

        // Cart Logic
        let cart = [];
        function addToCart(item, price) {
            cart.push({ item, price });
            updateCartUI();
            alert(`Added ${item} to cart`);
        }
        function clearCart() { cart = []; updateCartUI(); }
        function updateCartUI() {
            document.getElementById('nav-cart-count').innerText = cart.length;
            const container = document.getElementById('cart-items-container');
            const footer = document.getElementById('cart-footer');
            if (cart.length === 0) {
                container.innerHTML = '<i class="ph ph-shopping-cart" style="font-size: 3rem; margin-bottom: 10px;"></i>Your cart is currently empty.';
                footer.classList.add('hidden');
            } else {
                container.innerHTML = cart.map(i => `
                    <div class="flex justify-between w-full p-2" style="background: var(--bg-hover); border-radius: 4px;">
                        <span>${i.item}</span><span>$${i.price}</span>
                    </div>`).join('');
                footer.classList.remove('hidden');
                const total = cart.reduce((a, b) => a + b.price, 0);
                document.getElementById('cart-total').innerText = '$' + total.toLocaleString();
            }
        }

        function switchTab(tabId, el) {
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            if (el) el.classList.add('active'); // Sidebar click

            document.querySelectorAll('.app-section').forEach(s => s.classList.add('hidden'));
            const tab = document.getElementById('tab-' + tabId);
            if (tab) {
                tab.classList.remove('hidden');
                document.getElementById('page-title').innerText = tabId.charAt(0).toUpperCase() + tabId.slice(1);
            }
        }

        function handleCheckout() {
            if (cart.length === 0) return;

            const total = cart.reduce((a, b) => a + b.price, 0);
            if (!confirm(`Proceed with payment of $${total.toLocaleString()}?`)) return;

            // Mock API/Processing
            const date = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            const orderId = '#ORD-' + Math.floor(1000 + Math.random() * 9000);
            const itemsSummary = cart.map(i => i.item).join(', ');
            const displayService = cart.length === 1 ? cart[0].item : 'Multiple Services';

            // Add to Orders
            const ordersTbody = document.querySelector('#tab-orders tbody');
            const orderRow = `<tr onclick="viewOrder(this)" style="cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='var(--bg-hover)'" onmouseout="this.style.background=''"><td>${orderId}</td><td>${displayService}</td><td>${date}</td><td><span class="badge badge-success">Processing</span></td><td>$${total.toLocaleString()}</td></tr>`;
            ordersTbody.insertAdjacentHTML('afterbegin', orderRow);

            // Add to Invoices
            const billingTbody = document.querySelector('#tab-billing tbody');
            const invId = '#INV-' + Math.floor(1000 + Math.random() * 9000);
            const invRow = `<tr><td>${invId}</td><td>${date}</td><td>$${total.toLocaleString()}</td><td><span class="badge badge-success">Paid</span></td><td><button class="btn btn-outline" style="padding: 4px 8px;">Download</button></td></tr>`;
            billingTbody.insertAdjacentHTML('afterbegin', invRow);

            alert('Payment Successful! Order placed.');
            clearCart();
            switchTab('orders');
        }

        function viewOrder(row) {
            const cells = row.children;
            const id = cells[0].innerText;
            const service = cells[1].innerText;
            const date = cells[2].innerText;
            const status = cells[3].innerHTML;
            const total = cells[4].innerText;

            const content = `
                <div class="flex flex-col gap-md">
                    <div class="flex justify-between"><span style="color: var(--text-muted);">Order ID</span><span style="font-weight: 600;">${id}</span></div>
                    <div class="flex justify-between"><span style="color: var(--text-muted);">Service</span><span style="font-weight: 600;">${service}</span></div>
                    <div class="flex justify-between"><span style="color: var(--text-muted);">Date</span><span>${date}</span></div>
                    <div class="flex justify-between"><span style="color: var(--text-muted);">Status</span><div>${status}</div></div>
                    <div class="flex justify-between" style="border-top: 1px solid var(--border); padding-top: 10px; margin-top: 10px;">
                        <span style="font-size: 1.1rem; font-weight: 600;">Total</span>
                        <span style="font-size: 1.1rem; font-weight: 600; color: var(--success);">${total}</span>
                    </div>
                </div>
            `;
            document.getElementById('order-modal-content').innerHTML = content;
            document.getElementById('order-modal').style.display = 'flex';
        }

        function closeOrderModal() { document.getElementById('order-modal').style.display = 'none'; }

        function inviteMember() {
            const email = prompt("Enter email address to invite:");
            if (email) {
                if (!email.includes('@')) { alert('Invalid email'); return; }
                const container = document.getElementById('team-list');
                const initials = email.substring(0, 2).toUpperCase();
                const html = `
                    <div class="flex items-center justify-between p-2" style="border-bottom: 1px solid var(--border); padding-bottom: 10px;">
                        <div class="flex items-center gap-md">
                            <div class="avatar">${initials}</div>
                            <div>
                                <div style="font-weight: 600;">${email.split('@')[0]}</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">${email}</div>
                            </div>
                        </div>
                        <span class="badge badge-warning">Pending</span>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', html);
                alert(`Invitation sent to ${email}`);
            }
        }

        function payInvoice(btn) {
            const row = btn.closest('tr');
            const amount = row.cells[2].innerText;
            if (confirm(`Process payment for ${amount}?`)) {
                // Mock Processing
                setTimeout(() => {
                    alert('Payment Successful!');
                    // Update Status
                    row.cells[3].innerHTML = '<span class="badge badge-success">Paid</span>';
                    // Update Action
                    row.cells[4].innerHTML = '<button class="btn btn-outline" style="padding: 4px 8px;">Download</button>';
                }, 500);
            }
        }

        function createTicket() {
            const subject = prompt("Describe your issue (Subject):");
            if (subject) {
                const emptyState = document.getElementById('support-empty-state');
                const list = document.getElementById('ticket-list');

                emptyState.classList.add('hidden');
                list.classList.remove('hidden');

                const ticketId = '#TKT-' + Math.floor(1000 + Math.random() * 9000);
                const html = `
                    <div class="flex items-center justify-between p-3" style="background: var(--bg-hover); border-radius: 8px;">
                        <div>
                            <div style="font-weight: 600;">${subject}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">${ticketId} â€¢ Just now</div>
                        </div>
                        <span class="badge badge-primary">Open</span>
                    </div>
                `;
                list.insertAdjacentHTML('afterbegin', html);
            }
        }

        function toggleProfileMenu() {
            const menu = document.getElementById('profile-menu');
            menu.classList.toggle('hidden');
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notification-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function logout() {
            localStorage.removeItem('user_session');
            window.location.href = 'index.html';
        }
    </script>
</body>

</html>